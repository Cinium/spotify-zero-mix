(this["webpackJsonpspotify-single-daily"]=this["webpackJsonpspotify-single-daily"]||[]).push([[0],{32:function(t,e,n){},33:function(t,e,n){},41:function(t,e,n){},42:function(t,e,n){},43:function(t,e,n){},44:function(t,e,n){},53:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n(18),c=n.n(r),s=(n(32),n(33),n(2)),i=n.n(s),o=n(10),u=n(4),l=n(19),p=n(20),f=["playlist-read-private","playlist-modify-private","playlist-modify-public"].join("%20"),h=new(function(){function t(){Object(l.a)(this,t)}return Object(p.a)(t,[{key:"login",value:function(){window.location="".concat("https://accounts.spotify.com/authorize","?client_id=").concat("6f24e1aa19004f7cab42054a136c6efb","&redirect_uri=").concat("https://cinium.github.io/spotify-zero-mix","&scope=").concat(f,"&response_type=token&show_dialog=true")}},{key:"getTokenDataFromUrl",value:function(t){var e=t.substring(1).split("&"),n={created:new Date};e.forEach((function(t){var e=t.split("="),a=Object(o.a)(e,2),r=a[0],c=a[1];n[r]=c})),localStorage.setItem("token",JSON.stringify(n))}},{key:"checkIfTokenExpired",value:function(){var t=JSON.parse(localStorage.getItem("token")),e=new Date(t.created);return Math.abs(((new Date).getTime()-e.getTime())/1e3)>3600}}]),t}()),b=n(3),d=n(1);var j=function(){var t=Object(b.useNavigate)();function e(){return(e=Object(u.a)(i.a.mark((function e(n){var a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.substring(1).split("&"),r={},a.forEach((function(t){var e=t.split("="),n=Object(o.a)(e,2),a=n[0],c=n[1];r[a]=c})),localStorage.setItem("token",JSON.stringify(r)),t("/playlists");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){!function(t){e.apply(this,arguments)}(window.location.hash)}),[]),Object(d.jsx)("div",{children:Object(d.jsx)("main",{children:Object(d.jsx)("h1",{children:"Logging you in..."})})})},v=n(8),y=function(){function t(e){Object(l.a)(this,t),this.base_url=e}return Object(p.a)(t,[{key:"getTokenFromLocal",value:function(){if(localStorage.getItem("token"))return JSON.parse(localStorage.getItem("token"))}},{key:"getPlaylists",value:function(){var t=Object(u.a)(i.a.mark((function t(){var e,n,a,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTokenFromLocal();case 2:return e=t.sent,t.next=5,fetch("".concat(this.base_url,"/v1/me/playlists"),{method:"GET",headers:{Authorization:"".concat(e.token_type," ").concat(e.access_token)}});case 5:return n=t.sent,t.next=8,n.json();case 8:return a=t.sent,t.next=11,a.items;case 11:return r=t.sent,t.abrupt("return",r);case 13:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getPlaylistItems",value:function(){var t=Object(u.a)(i.a.mark((function t(e,n){var a,r,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/playlists/").concat(e,"/tracks").concat(n?"?offset=".concat(n,"&limit=100"):""),{method:"GET",headers:{Authorization:"".concat(a.token_type," ").concat(a.access_token)}});case 3:return r=t.sent,t.next=6,r.json();case 6:return c=t.sent,t.abrupt("return",c);case 8:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getUserInfo",value:function(){var t=Object(u.a)(i.a.mark((function t(){var e,n,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/me"),{method:"GET",headers:{Authorization:"".concat(e.token_type," ").concat(e.access_token)}});case 3:return n=t.sent,t.next=6,n.json();case 6:return a=t.sent,t.abrupt("return",a);case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"createPlaylist",value:function(){var t=Object(u.a)(i.a.mark((function t(e){var n,a,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/users/").concat(e,"/playlists"),{method:"POST",headers:{Authorization:"".concat(n.token_type," ").concat(n.access_token),"Content-Type":"application/json"},body:JSON.stringify({name:"\u041c\u0438\u043a\u0441 \u0434\u043d\u044f #0",description:"All in one daily mix",public:!1})});case 3:return a=t.sent,r=a.json(),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addItemsToPlayList",value:function(){var t=Object(u.a)(i.a.mark((function t(e,n){var a,r,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/playlists/").concat(e,"/tracks"),{method:"POST",headers:{Authorization:"".concat(a.token_type," ").concat(a.access_token),"Content-Type":"application/json"},body:JSON.stringify({uris:n,position:0})});case 3:return r=t.sent,c=r.json(),t.abrupt("return",c);case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"deleteItemsFromPlaylist",value:function(){var t=Object(u.a)(i.a.mark((function t(e,n){var a,r,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/playlists/").concat(e,"/tracks"),{method:"DELETE",headers:{Authorization:"".concat(a.token_type," ").concat(a.access_token),"Content-Type":"application/json"},body:JSON.stringify({tracks:n})});case 3:return r=t.sent,c=r.json(),t.abrupt("return",c);case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),m=new y("https://api.spotify.com"),x="SET_CURRENT_USER",O="IS_LOADING",g="DAILY_MIXES",k="ZERO_MIX",w="TRACKS",_="NEW_DAILY_MIX";var N=function(){var t=Object(b.useNavigate)(),e=Object(v.useDispatch)();return Object(a.useEffect)((function(){window.location.hash&&(h.getTokenDataFromUrl(window.location.hash),e(function(){var t=Object(u.a)(i.a.mark((function t(e){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,m.getUserInfo();case 3:n=t.sent,localStorage.setItem("user",JSON.stringify(n)),e({type:x,payload:n}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}()),t("/playlists"))}),[]),Object(d.jsxs)("main",{children:[Object(d.jsx)("h2",{className:"title",children:"\u0412\u043e\u0439\u0434\u0438 \u0432 Spotify"}),Object(d.jsx)("button",{onClick:h.login,className:"button",children:"\u0412\u043e\u0439\u0442\u0438"})]})},S=n(12),T=n(16);function I(t){return{type:O,payload:t}}function F(t){return{type:g,payload:t}}function L(t){return{type:w,payload:t}}n(41);var D=function(){return Object(d.jsxs)("div",{className:"lds-ring",children:[Object(d.jsx)("div",{}),Object(d.jsx)("div",{}),Object(d.jsx)("div",{}),Object(d.jsx)("div",{})]})};n(42);function E(){var t=Object(v.useSelector)((function(t){return t.user})),e=Object(v.useSelector)((function(t){return t.app.isLoading})),n=Object(v.useDispatch)();function a(){return r.apply(this,arguments)}function r(){return(r=Object(u.a)(i.a.mark((function t(){var e,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.getPlaylists();case 2:return e=t.sent,a=g(e),n(F(a)),t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function c(t){return s.apply(this,arguments)}function s(){return(s=Object(u.a)(i.a.mark((function t(e){var n,a,r,c;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.getPlaylistItems(e);case 2:if(n=t.sent,a=Object(T.a)(n.items),!(n.total>n.items.length)){t.next=14;break}r=100;case 6:if(!(r<n.total)){t.next=14;break}return t.next=9,m.getPlaylistItems(e,r);case 9:c=t.sent,a=[].concat(Object(T.a)(a),Object(T.a)(c.items));case 11:r+=100,t.next=6;break;case 14:o(e,a);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function o(t,e){return l.apply(this,arguments)}function l(){return(l=Object(u.a)(i.a.mark((function t(e,n){var a,r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],n.forEach((function(t){a=[].concat(Object(T.a)(a),[{uri:t.track.uri}])}));case 2:if(!(a.length>0)){t.next=8;break}return r=a.splice(0,100),t.next=6,m.deleteItemsFromPlaylist(e,r);case 6:t.next=2;break;case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){return f.apply(this,arguments)}function f(){return(f=Object(u.a)(i.a.mark((function t(e){var a,r,c,s,o,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],r=Object(S.a)(e),t.prev=2,r.s();case 4:if((c=r.n()).done){t.next=14;break}if("\u041c\u0438\u043a\u0441 \u0434\u043d\u044f #0"===(s=c.value).name){t.next=12;break}return t.next=9,m.getPlaylistItems(s.id);case 9:o=t.sent,u=o.items,a=a.concat(u);case 12:t.next=4;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(2),r.e(t.t0);case 19:return t.prev=19,r.f(),t.finish(19);case 22:return n(L(a)),t.abrupt("return",a);case 24:case"end":return t.stop()}}),t,null,[[2,16,19,22]])})))).apply(this,arguments)}function b(){return j.apply(this,arguments)}function j(){return(j=Object(u.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.createPlaylist(t.id);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(t,e){return x.apply(this,arguments)}function x(){return(x=Object(u.a)(i.a.mark((function t(e,n){var a,r,c,s,o,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.length>0)){t.next=11;break}r=[],a=n.splice(0,100),c=Object(S.a)(a);try{for(c.s();!(s=c.n()).done;)o=s.value,r.push(o.track.uri)}catch(i){c.e(i)}finally{c.f()}return t.next=7,m.addItemsToPlayList(e.id,O(r));case 7:u=t.sent,console.log(u),t.next=0;break;case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function O(t){for(var e,n=t.length;0!==n;){e=Math.floor(Math.random()*n),n--;var a=[t[e],t[n]];t[n]=a[0],t[e]=a[1]}return t}function g(t){return t.filter((function(t){return t.name.includes("\u041c\u0438\u043a\u0441 \u0434\u043d\u044f")}))}function k(){var t=JSON.parse(localStorage.getItem("token")),e=new Date(t.created);return Math.abs(((new Date).getTime()-e.getTime())/1e3)>3600}function w(){return(w=Object(u.a)(i.a.mark((function t(){var e,r,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(I(!0)),k()&&h.login(),t.next=4,a();case 4:return e=t.sent,t.next=7,p(e);case 7:if(r=t.sent,!(s=e.find((function(t){return"\u041c\u0438\u043a\u0441 \u0434\u043d\u044f #0"===t.name})))){t.next=15;break}return t.next=12,c(s.id);case 12:y(s,r),t.next=19;break;case 15:return t.next=17,b();case 17:y(t.sent,r);case 19:n(I(!1));case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(d.jsxs)("div",{className:"playlists",children:[Object(d.jsx)("h2",{className:"title",children:"\u0412\u0440\u0435\u043c\u044f \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043b\u0435\u0439\u043b\u0438\u0441\u0442 \u0434\u043d\u044f!"}),Object(d.jsx)("button",{onClick:function(){return w.apply(this,arguments)},disabled:!!e,className:"playlists__create-button button ".concat(e&&"button_disabled"),children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043b\u0435\u0439\u043b\u0438\u0441\u0442"}),e&&Object(d.jsx)(D,{})]})}var P=n(11);n(43);var A=function(){return Object(d.jsxs)("ul",{className:"navbar",children:[Object(d.jsx)("li",{className:"navbar__item",children:Object(d.jsx)(P.b,{to:"/about",className:"navbar__link",style:function(t){var e=t.isActive;return{fontWeight:e?"500":"400",backgroundColor:e?"#D0BCFF":"",padding:e?"3px 12px 6px":""}},children:"About"})}),Object(d.jsx)("li",{className:"navbar__item",children:Object(d.jsx)(P.b,{to:"/",className:"navbar__link",style:function(t){var e=t.isActive;return{fontWeight:e?"500":"400",backgroundColor:e?"#D0BCFF":"",padding:e?"3px 12px 6px":""}},children:"Login"})}),Object(d.jsx)("li",{className:"navbar__item",children:Object(d.jsx)(P.b,{to:"/playlists",className:"navbar__link",style:function(t){var e=t.isActive;return{fontWeight:e?"500":"400",backgroundColor:e?"#D0BCFF":"",padding:e?"3px 12px 6px":""}},children:"Generate"})})]})};n(44);var C=function(){var t,e,n=Object(v.useSelector)((function(t){return t.user}));return Object(d.jsxs)("header",{className:"header",children:["Spotify Zero Mix",0!==(null===n||void 0===n||null===(t=n.images)||void 0===t?void 0:t.length)?Object(d.jsx)("img",{src:null===n||void 0===n||null===(e=n.images)||void 0===e?void 0:e.large,className:"header__user-pic",style:{},alt:"user pic"}):Object(d.jsx)("div",{className:"header__avatar",children:null===n||void 0===n?void 0:n.display_name.slice(0,1)})]})};var J=function(){return console.log(window.location.pathname),Object(d.jsxs)("div",{className:"App",children:[Object(d.jsx)(C,{}),Object(d.jsxs)(P.a,{children:[Object(d.jsx)(A,{}),Object(d.jsxs)(b.Routes,{children:[Object(d.jsx)(b.Route,{path:"/",element:Object(d.jsx)(N,{})}),Object(d.jsx)(b.Route,{path:"callback",element:Object(d.jsx)(j,{})}),Object(d.jsx)(b.Route,{path:"playlists",element:Object(d.jsx)(E,{})})]})]})]})},M=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,54)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,c=e.getLCP,s=e.getTTFB;n(t),a(t),r(t),c(t),s(t)}))},R=n(14),z=n(27),U=n(25),B=n(26),G=n(6),W=Object(G.b)(),X=n(7),Y=JSON.parse(localStorage.getItem("user")),Z=Y||{};var K=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,e=arguments.length>1?arguments[1]:void 0;return e.type===x?Object(X.a)(Object(X.a)({},t),{},{user:e.payload}):t},q={isLoading:!1};var H=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,e=arguments.length>1?arguments[1]:void 0;return e.type===O?Object(X.a)(Object(X.a)({},t),{},{isLoading:e.payload}):t};var Q=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case g:return Object(X.a)(Object(X.a)({},t),{},{dailyMixes:e.payload});case k:return Object(X.a)(Object(X.a)({},t),{},{zeroMix:e.payload});case _:return Object(X.a)(Object(X.a)({},t),{},{newDailyMix:e.payload});default:return t}},V=Object(R.combineReducers)({router:Object(B.connectRouter)(W),user:K,app:H,playlists:Q}),$=Object(R.createStore)(V,Object(U.composeWithDevTools)(Object(R.applyMiddleware)(z.a)));c.a.render(Object(d.jsx)(v.Provider,{store:$,children:Object(d.jsx)(J,{})}),document.getElementById("root")),M()}},[[53,1,2]]]);
//# sourceMappingURL=main.7c872cae.chunk.js.map