(this["webpackJsonpspotify-single-daily"]=this["webpackJsonpspotify-single-daily"]||[]).push([[0],{32:function(t,e,n){},33:function(t,e,n){},41:function(t,e,n){},42:function(t,e,n){},43:function(t,e,n){},44:function(t,e,n){},53:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n(18),c=n.n(r),s=(n(32),n(33),n(8)),i=n(2),o=n(11),u=n(19),l=n(20),p=["playlist-read-private","playlist-modify-private","playlist-modify-public"].join("%20"),f=new(function(){function t(){Object(u.a)(this,t)}return Object(l.a)(t,[{key:"login",value:function(){window.location="".concat("https://accounts.spotify.com/authorize","?client_id=").concat("6f24e1aa19004f7cab42054a136c6efb","&redirect_uri=").concat("https://cinium.github.io/spotify-zero-mix","&scope=").concat(p,"&response_type=token&show_dialog=true")}},{key:"getTokenDataFromUrl",value:function(t){var e=t.substring(1).split("&"),n={created:new Date};e.forEach((function(t){var e=t.split("="),a=Object(o.a)(e,2),r=a[0],c=a[1];n[r]=c})),localStorage.setItem("token",JSON.stringify(n))}},{key:"checkIfTokenExpired",value:function(){var t=JSON.parse(localStorage.getItem("token")),e=new Date(t.created);return Math.abs(((new Date).getTime()-e.getTime())/1e3)>3600}}]),t}()),h=n(3),b=n.n(h),d=n(4),j=function(){function t(e){Object(u.a)(this,t),this.base_url=e}return Object(l.a)(t,[{key:"getTokenFromLocal",value:function(){if(localStorage.getItem("token"))return JSON.parse(localStorage.getItem("token"))}},{key:"getPlaylists",value:function(){var t=Object(d.a)(b.a.mark((function t(){var e,n,a,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTokenFromLocal();case 2:return e=t.sent,t.next=5,fetch("".concat(this.base_url,"/v1/me/playlists"),{method:"GET",headers:{Authorization:"".concat(e.token_type," ").concat(e.access_token)}});case 5:return n=t.sent,t.next=8,n.json();case 8:return a=t.sent,t.next=11,a.items;case 11:return r=t.sent,t.abrupt("return",r);case 13:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"getPlaylistItems",value:function(){var t=Object(d.a)(b.a.mark((function t(e,n){var a,r,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/playlists/").concat(e,"/tracks").concat(n?"?offset=".concat(n,"&limit=100"):""),{method:"GET",headers:{Authorization:"".concat(a.token_type," ").concat(a.access_token)}});case 3:return r=t.sent,t.next=6,r.json();case 6:return c=t.sent,t.abrupt("return",c);case 8:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getUserInfo",value:function(){var t=Object(d.a)(b.a.mark((function t(){var e,n,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/me"),{method:"GET",headers:{Authorization:"".concat(e.token_type," ").concat(e.access_token)}});case 3:return n=t.sent,t.next=6,n.json();case 6:return a=t.sent,t.abrupt("return",a);case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"createPlaylist",value:function(){var t=Object(d.a)(b.a.mark((function t(e){var n,a,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/users/").concat(e,"/playlists"),{method:"POST",headers:{Authorization:"".concat(n.token_type," ").concat(n.access_token),"Content-Type":"application/json"},body:JSON.stringify({name:"\u041c\u0438\u043a\u0441 \u0434\u043d\u044f #0",description:"All in one daily mix",public:!1})});case 3:return a=t.sent,r=a.json(),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addItemsToPlayList",value:function(){var t=Object(d.a)(b.a.mark((function t(e,n){var a,r,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/playlists/").concat(e,"/tracks"),{method:"POST",headers:{Authorization:"".concat(a.token_type," ").concat(a.access_token),"Content-Type":"application/json"},body:JSON.stringify({uris:n,position:0})});case 3:return r=t.sent,c=r.json(),t.abrupt("return",c);case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"deleteItemsFromPlaylist",value:function(){var t=Object(d.a)(b.a.mark((function t(e,n){var a,r,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.getTokenFromLocal(),t.next=3,fetch("".concat(this.base_url,"/v1/playlists/").concat(e,"/tracks"),{method:"DELETE",headers:{Authorization:"".concat(a.token_type," ").concat(a.access_token),"Content-Type":"application/json"},body:JSON.stringify({tracks:n})});case 3:return r=t.sent,c=r.json(),t.abrupt("return",c);case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),v=new j("https://api.spotify.com"),y="SET_CURRENT_USER",m="IS_LOADING",x="DAILY_MIXES",O="ZERO_MIX",g="TRACKS",k="NEW_DAILY_MIX";var _=n(1);var w=function(){var t=Object(i.useNavigate)(),e=Object(s.useDispatch)();return Object(a.useEffect)((function(){window.location.hash&&"#/playlists"!==window.location.hash&&(f.getTokenDataFromUrl(window.location.hash),e(function(){var t=Object(d.a)(b.a.mark((function t(e){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,v.getUserInfo();case 3:n=t.sent,localStorage.setItem("user",JSON.stringify(n)),e({type:y,payload:n}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}()),t("/playlists"))}),[]),Object(_.jsxs)("main",{children:[Object(_.jsx)("h2",{className:"title",children:"\u0412\u043e\u0439\u0434\u0438 \u0432 Spotify"}),Object(_.jsx)("button",{onClick:f.login,className:"button",children:"\u0412\u043e\u0439\u0442\u0438"})]})},T=n(12),N=n(16);function S(t){return{type:m,payload:t}}function I(t){return{type:x,payload:t}}function F(t){return{type:g,payload:t}}n(41);var D=function(){return Object(_.jsxs)("div",{className:"lds-ring",children:[Object(_.jsx)("div",{}),Object(_.jsx)("div",{}),Object(_.jsx)("div",{}),Object(_.jsx)("div",{})]})};n(42);function L(){var t=Object(s.useSelector)((function(t){return t.user})),e=Object(s.useSelector)((function(t){return t.app.isLoading})),n=Object(s.useDispatch)();function a(){return r.apply(this,arguments)}function r(){return(r=Object(d.a)(b.a.mark((function t(){var e,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.getPlaylists();case 2:return e=t.sent,a=O(e),n(I(a)),t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function c(t){return i.apply(this,arguments)}function i(){return(i=Object(d.a)(b.a.mark((function t(e){var n,a,r,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.getPlaylistItems(e);case 2:if(n=t.sent,a=Object(N.a)(n.items),!(n.total>n.items.length)){t.next=14;break}r=100;case 6:if(!(r<n.total)){t.next=14;break}return t.next=9,v.getPlaylistItems(e,r);case 9:c=t.sent,a=[].concat(Object(N.a)(a),Object(N.a)(c.items));case 11:r+=100,t.next=6;break;case 14:o(e,a);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function o(t,e){return u.apply(this,arguments)}function u(){return(u=Object(d.a)(b.a.mark((function t(e,n){var a,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],n.forEach((function(t){a=[].concat(Object(N.a)(a),[{uri:t.track.uri}])}));case 2:if(!(a.length>0)){t.next=8;break}return r=a.splice(0,100),t.next=6,v.deleteItemsFromPlaylist(e,r);case 6:t.next=2;break;case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function l(t){return p.apply(this,arguments)}function p(){return(p=Object(d.a)(b.a.mark((function t(e){var a,r,c,s,i,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],r=Object(T.a)(e),t.prev=2,r.s();case 4:if((c=r.n()).done){t.next=14;break}if("\u041c\u0438\u043a\u0441 \u0434\u043d\u044f #0"===(s=c.value).name){t.next=12;break}return t.next=9,v.getPlaylistItems(s.id);case 9:i=t.sent,o=i.items,a=a.concat(o);case 12:t.next=4;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(2),r.e(t.t0);case 19:return t.prev=19,r.f(),t.finish(19);case 22:return n(F(a)),t.abrupt("return",a);case 24:case"end":return t.stop()}}),t,null,[[2,16,19,22]])})))).apply(this,arguments)}function h(){return j.apply(this,arguments)}function j(){return(j=Object(d.a)(b.a.mark((function e(){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.createPlaylist(t.id);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(t,e){return m.apply(this,arguments)}function m(){return(m=Object(d.a)(b.a.mark((function t(e,n){var a,r,c,s,i,o;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.length>0)){t.next=11;break}r=[],a=n.splice(0,100),c=Object(T.a)(a);try{for(c.s();!(s=c.n()).done;)i=s.value,r.push(i.track.uri)}catch(u){c.e(u)}finally{c.f()}return t.next=7,v.addItemsToPlayList(e.id,x(r));case 7:o=t.sent,console.log(o),t.next=0;break;case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t){for(var e,n=t.length;0!==n;){e=Math.floor(Math.random()*n),n--;var a=[t[e],t[n]];t[n]=a[0],t[e]=a[1]}return t}function O(t){return t.filter((function(t){return t.name.includes("\u041c\u0438\u043a\u0441 \u0434\u043d\u044f")}))}function g(){var t=JSON.parse(localStorage.getItem("token")),e=new Date(t.created);return Math.abs(((new Date).getTime()-e.getTime())/1e3)>3600}function k(){return(k=Object(d.a)(b.a.mark((function t(){var e,r,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(S(!0)),g()&&f.login(),t.next=4,a();case 4:return e=t.sent,t.next=7,l(e);case 7:if(r=t.sent,!(s=e.find((function(t){return"\u041c\u0438\u043a\u0441 \u0434\u043d\u044f #0"===t.name})))){t.next=15;break}return t.next=12,c(s.id);case 12:y(s,r),t.next=19;break;case 15:return t.next=17,h();case 17:y(t.sent,r);case 19:n(S(!1));case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object(_.jsxs)("div",{className:"playlists",children:[Object(_.jsx)("h2",{className:"title",children:"\u0412\u0440\u0435\u043c\u044f \u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043b\u0435\u0439\u043b\u0438\u0441\u0442 \u0434\u043d\u044f!"}),Object(_.jsx)("button",{onClick:function(){return k.apply(this,arguments)},disabled:!!e,className:"playlists__create-button button ".concat(e&&"button_disabled"),children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043b\u0435\u0439\u043b\u0438\u0441\u0442"}),e&&Object(_.jsx)(D,{})]})}var E=n(10);n(43);var P=function(){return Object(_.jsxs)("ul",{className:"navbar",children:[Object(_.jsx)("li",{className:"navbar__item",children:Object(_.jsx)(E.b,{to:"/about",className:"navbar__link",style:function(t){var e=t.isActive;return{fontWeight:e?"500":"400",backgroundColor:e?"#D0BCFF":"",padding:e?"3px 12px 6px":""}},children:"About"})}),Object(_.jsx)("li",{className:"navbar__item",children:Object(_.jsx)(E.b,{to:"/",className:"navbar__link",style:function(t){var e=t.isActive;return{fontWeight:e?"500":"400",backgroundColor:e?"#D0BCFF":"",padding:e?"3px 12px 6px":""}},children:"Login"})}),Object(_.jsx)("li",{className:"navbar__item",children:Object(_.jsx)(E.b,{to:"/playlists",className:"navbar__link",style:function(t){var e=t.isActive;return{fontWeight:e?"500":"400",backgroundColor:e?"#D0BCFF":"",padding:e?"3px 12px 6px":""}},children:"Generate"})})]})};n(44);var A=function(){var t,e,n=Object(s.useSelector)((function(t){return t.user}));return Object(_.jsxs)("header",{className:"header",children:["Spotify Zero Mix",0!==(null===n||void 0===n||null===(t=n.images)||void 0===t?void 0:t.length)?Object(_.jsx)("img",{src:null===n||void 0===n||null===(e=n.images)||void 0===e?void 0:e.large,className:"header__user-pic",style:{},alt:"user pic"}):Object(_.jsx)("div",{className:"header__avatar",children:null===n||void 0===n?void 0:n.display_name.slice(0,1)})]})};var C=function(){return Object(_.jsxs)("div",{className:"App",children:[Object(_.jsx)(A,{}),Object(_.jsx)(P,{}),Object(_.jsxs)(i.Routes,{children:[Object(_.jsx)(i.Route,{path:"/",element:Object(_.jsx)(w,{})}),Object(_.jsx)(i.Route,{path:"playlists",element:Object(_.jsx)(L,{})})]})]})},M=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,54)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,c=e.getLCP,s=e.getTTFB;n(t),a(t),r(t),c(t),s(t)}))},J=n(14),R=n(27),z=n(25),U=n(26),B=n(6),G=Object(B.b)(),W=n(7),X=JSON.parse(localStorage.getItem("user")),Y=X||{};var Z=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,e=arguments.length>1?arguments[1]:void 0;return e.type===y?Object(W.a)(Object(W.a)({},t),{},{user:e.payload}):t},K={isLoading:!1};var q=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,e=arguments.length>1?arguments[1]:void 0;return e.type===m?Object(W.a)(Object(W.a)({},t),{},{isLoading:e.payload}):t};var H=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case x:return Object(W.a)(Object(W.a)({},t),{},{dailyMixes:e.payload});case O:return Object(W.a)(Object(W.a)({},t),{},{zeroMix:e.payload});case k:return Object(W.a)(Object(W.a)({},t),{},{newDailyMix:e.payload});default:return t}},Q=Object(J.combineReducers)({router:Object(U.connectRouter)(G),user:Z,app:q,playlists:H}),V=Object(J.createStore)(Q,Object(z.composeWithDevTools)(Object(J.applyMiddleware)(R.a)));c.a.render(Object(_.jsx)(s.Provider,{store:V,children:Object(_.jsx)(E.a,{children:Object(_.jsx)(C,{})})}),document.getElementById("root")),M()}},[[53,1,2]]]);
//# sourceMappingURL=main.62337259.chunk.js.map